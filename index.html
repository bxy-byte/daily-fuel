<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全国油价查询</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        .bg{
            width: 100vw;
            height: 100vh;
            background-image: url(./resources/bgImages.jpg);
            background-size: cover;
        }
        .head{
            text-align: center;
            color:coral
        }
        .spanPrice{
            font-size: 30px;
            color:#292d8f;
        }
        .searchDiv{
            background-color: #faebd7b0;
            border-radius: 18px;
            margin: 35px 25px;
            padding: 6px;
            font-size: 25px;
        }
        .inputDiv{
            width: 200px;
            font-size: 25px;
        }
        .font{
            font-size: 25px;
        }
        .select{
            width: 200px;
            font-size: 25px;
        }
        .priceDiv{
            background-color: #faebd7bf;
            margin:65px 25px 0;
            padding: 20px;
            border-radius: 18px;
            position: relative;
        }
        .buttonQuery{
            font-size: 20px;
            color: darkcyan;
            background-color: beige;
            border-radius: 10px;
        }
        .loader{
            display: none;
            width: 32px;
            height: 32px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        @keyframes spin{
            0% {transform: translate(-50%, -50%) rotate(0deg);}
            100% {transform:translate(-50%, -50%) rotate(360deg);}
        }
    </style>
</head>
<body>
    <div class="bg">
        <h1 class="head">全国油价查询</h1>
        <div class="searchDiv">
            <span class="font">地区：</span><input class="inputDiv" id="inputDis" type="text"><br>
            <span class="font">省(市)：</span><select class="select" id="selectProvinces" >
                <option>请选择省</option>
            </select><br>
            <span class="font">市：</span><select class="select" id="selectCities">
                <option>请选择市</option>
            </select><br>
            <span class="font">区(县/市)：</span><select class="select" id="selectDistricts">
                <option>请选择区</option>
            </select><br>
            <button class="buttonQuery" id="buttonQuery" onclick="getFuelPrice()">查询</button>
            <button class="buttonQuery" onclick="dbsFuelPrice()">调兵山油价</button>
            <button class="buttonQuery" onclick="dlFuelPrice()">大连油价</button>
        </div>
        <div class="priceDiv"> 
            <span class="spanPrice">92#汽油：</span><span id="price92" class="spanPrice"></span><br>
            <span class="spanPrice">95#汽油：</span><span id="price95" class="spanPrice"></span><br>
            <span class="spanPrice">98#汽油：</span><span id="price98" class="spanPrice"></span><br>
            <span class="spanPrice">0#柴油：</span><span id="price0" class="spanPrice"></span><br>
            <div class="loader" id="loader"></div>
        </div>
        
    </div>
    <script>
        const text1 = document.getElementById("text1")
        const inputDis = document.getElementById("inputDis")
        const selectProvinces = document.getElementById("selectProvinces")
        const selectCities = document.getElementById("selectCities")
        const selectDistricts = document.getElementById("selectDistricts")                
        const price92 = document.getElementById("price92")
        const price95 = document.getElementById("price95")
        const price98 = document.getElementById("price98")
        const price0 = document.getElementById("price0")
        const loader = document.getElementById('loader')

        let pcdDatas = []
        //填充省份下拉框
        function getPro(){
            $.ajax({
                url:'https://restapi.amap.com/v3/config/district?key=02583731ff74d3f51e33a223d2953520&keywords=中国&subdistrict=3',
                type:'GET',
                success:function(data){
                    pcdDatas = data.districts[0].districts
                    let optionsStr = '<option value=请选择省>请选择省</option>'
                    pcdDatas.forEach(pcdDatas => {
                        optionsStr += `
                            <option value=${pcdDatas.name}>${pcdDatas.name}</option>
                        `
                    });
                    selectProvinces.innerHTML = optionsStr
                }
            })            
        }
        getPro()
        //填充市下拉框
        function handleProviceChange(event){
            let optionsStr = `
                <option value=请选择市>请选择市</option>
            `              
            pcdDatas.forEach(pcdDatas => {
                if(pcdDatas.name === event.target.value){
                    pcdDatas.districts.forEach(elementCities => {
                        optionsStr += `
                            <option value=${elementCities.name}>${elementCities.name}</option>
                        `
                    })
                    selectCities.innerHTML = optionsStr
                }
            })
            inputDis.value = event.target.value.replace(/(省|自治区|维吾尔自治区|壮族自治区|回族自治区)$/,'')
        }
        selectProvinces.addEventListener('change', handleProviceChange)
        //填充区县到下拉框
        function handleCitiesChange(event){
            selectDistricts.innerHTML = ' '
            pcdDatas.forEach(pcdDatas => {
                if(pcdDatas.name === selectProvinces.value){
                    pcdDatas.districts.forEach(elementCities => {
                        if(elementCities.name === event.target.value){
                            let optionsStr = '<option value=请选择区县>请选择区县</option>'
                            elementCities.districts.forEach(elementDistricts => {
                                optionsStr += `
                                    <option value=${elementDistricts.name}>${elementDistricts.name}</option>
                                `
                            })
                            selectDistricts.innerHTML = optionsStr
                        }
                    })
                }
            })            
            inputDis.value = event.target.value.replace(/[区县市旗]$/,'')
        }
        //填充区县到地区输入框
        function handleDistrictsChange(event){
            inputDis.value = event.target.value.replace(/[区县市]$/,'')
        }
        selectDistricts.addEventListener('change',handleDistrictsChange)        
        selectCities.addEventListener('change',handleCitiesChange)
        //查询油价
        function getFuelPrice(){
            if(inputDis.value === '') {
                alert('请输入或选择地区')
                return
            }
            showLoading()
            $.ajax({
                url:'https://funny.age63.work/v2/fuel-price?region='+inputDis.value,
                type:'GET',
                // data:inputDis.value,
                success:function(data){
                    console.log(data)
                    if(data.code !== 200) alert(data.message + '\n' + '手动输入无“区/市”等后缀的地名尝试')
                    if(data.code === 200){ 
                        price92.innerHTML = data.data.items[0].price_desc
                        price95.innerHTML = data.data.items[1].price_desc
                        price98.innerHTML = data.data.items[2].price_desc
                        price0.innerHTML = data.data.items[3].price_desc
                    }
                },
                error:function(){

                },
                complete:function(){
                    hideLoading()
                }
            })
        }        
        //调兵山油价
        function dbsFuelPrice(){
            inputDis.value = '调兵山'
            getFuelPrice()
        }
        //大连油价
        function dlFuelPrice(){
            inputDis.value = '大连'
            getFuelPrice()
        }
        //loading
        function showLoading(){
            loader.style.display = 'block'
        }
        function hideLoading(){
            loader.style.display = 'none'
        }
    </script>
</body>
</html>